<%- include('header') -%>

<body>
    <!-- NAVIGATION BAR, LAHAT NG LINKS -->
	<nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
		<div class="container">
			<a class="navbar-brand" href="/home"><span class="text-secondary">NANDY's</span> HUB</a> <button aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-bs-target="#navbarSupportedContent" data-bs-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav ms-auto mb-2 mb-lg-0">
					<li class="nav-item">
						<a class="nav-link" href="/home">Services</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="#services">Reservation</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="https://maps.app.goo.gl/gZUHKY4czbAoKzpv5" target="_blank">Location</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>

    <section class="services section-padding" id="services">
        <div class="container">
            <div class="col-md-12">
                <div class="section-header pb-2">
                    <h3><strong>Reservation Form</strong></h3>
                </div>
            </div>
                <div class="border border-dark p-2 mb-2 border-opacity-50 rounded p-3">
                    <form action="/reservation" method="post">
                        <div class="row mb-3 pt-3">
                          <label for="name" class="col-sm-2 col-form-label">Name</label>
                          <div class="col-sm-6">
                            <input type="text" class="form-control" id="name" name="name">
                          </div>
                        </div>
                        <div class="row mb-3">
                          <label for="services" class="col-sm-2 col-form-label">Services</label>
                          <div class="col-sm-6">
                            <select id="haha" class="form-select" name="services" onchange="calculatePrice()">
                                <option disabled selected value>Choose...</option>
                                <option value="Normal Wash">Normal Wash</option>
                                <option value="Power Wash">Power Wash</option>
                                <option value="Dry">Dry</option>
                                <option value="Fold">Fold</option>
                                <option value="Wash and Fold">Wash and Fold</option>
                              </select>
                          </div>
                        </div>
                        <div class="row mb-3 pb-3">
                            <label for="size" class="col-sm-2 col-form-label">Size</label>
                            <div class="col-sm-6">
                              <select id="size" class="form-select" name="size" onchange="calculatePrice()">
                                  <option disabled selected value>Choose...</option>
                                  <option value="8kg below">8kg below</option>
                                  <option value="8kg to 10kg">8kg to 10kg</option>
                                </select>
                            </div>
                        </div>

                        <hr class="hr" />

                        <!--Order Details start-->
                        <div class="col-md-12">
                            <div class="section-header pb-2">
                                <h5><strong>Order Details</strong></h5>
                            </div>
                        </div>

                        <div class="row g-3">
                        <div class="col-md-5 ps-5">
                            <label for="products" class="form-label">Products</label>
                            <select id="products" class="form-select" name="products" onchange="calculatePrice()">
                                <option disabled selected value>Choose...</option>
                                <option value="None (Dry and Fold)">None (Dry and Fold)</option>
                                <option value="Airiel Sunrise Fresh Liquid Detergent">Airiel Sunrise Fresh Liquid Detergent</option>
                                <option value="Airiel Hygiene Pro Liquid Detergent">Airiel Hygiene Pro Liquid Detergent</option>
                                <option value="Airiel Passion Liquid Detergent">Airiel Passion Liquid Detergent</option>
                                <option value="Breeze Power Machine Liquid Detergent (BLUE)">Breeze Power Machine Liquid Detergent (BLUE)</option>
                                <option value="Breeze Power Machine Liquid Detergent (PINK)">Breeze Power Machine Liquid Detergent (PINK)</option>
                            </select>
                        </div>
                        <div class="col-md-2 ps-5">
                            <label for="qty" class="form-label">Quantity</label>
                            <select id="qty" class="form-select" name="quantity" onchange="calculatePrice()">
                              <option disabled selected value>Choose</option>
                              <option value="0">0 (Dry and Fold)</option>
                              <option value="1">1</option>
                              <option value="2">2</option>
                              <option value="3">3</option>
                              <option value="4">4</option>
                              <option value="5">5</option>
                            </select>
                        </div>
                        <div class="col-md-3 ps-5">
                            <label for="price" class="form-label">Price</label>
                            <input type="text" class="form-control" id="price" name="price" readonly>
                            <input type="hidden" id="hiddenPrice" name="hiddenPrice" value="0">
                        </div>
                        </div>

                        <hr class="hr" />

                        <!--Delivery Type start-->
                        <div class="col-md-12">
                            <div class="section-header pb-2">
                                <h5><strong>Delivery Type</strong></h5>
                            </div>
                        </div>
                        <div class="row g-1">
                            <div class="col-md-5 ps-5">
                                <label for="delivery" class="form-label"></label>
                                <select id="delivery" class="form-select" name="delivery" onchange="calculatePrice()">
                                    <option disabled selected value>Choose...</option>
                                    <option value="Self Service">Self-Service</option>
                                    <option value="Drop-off Service">Drop-off Service</option>
                                    <option value="Pick Up">Pick up</option>
                                    <option value="Pick-up and Delivery">Pick-up and Delivery</option>
                                </select>
                            </div>
                            </div>

                        <hr class="hr" />

                        <!--Order Charges start-->
                        <div class="col-md-12">
                            <div class="section-header pb-2">
                                <h5><strong>Order Charges</strong></h5>
                            </div>
                        </div>

                        <div class="row g-3 pb-3">
                        <div class="col-md-5 ps-5">
                            <label for="subtotal" class="form-label">Subtotal</label>
                            <input type="text" class="form-control" id="subtotal" name="subtotal" readonly>
                            <input type="hidden" id="hiddenSubtotal" name="hiddenSubtotal" value="0">
                        </div>
                        <div class="col-md-5 ps-5">
                            <label for="deliveryfee" class="form-label">Delivery Fee</label>
                            <input type="text" class="form-control" id="deliveryfee" name="deliveryfee" readonly>
                            <input type="hidden" id="hiddenDeliveryFee" name="hiddenDeliveryFee" value="0">
                        </div>
                        <div class="col-md-5 ps-5">
                            <label for="datetime" class="form-label">Date and Time</label>
                            <div class="row-md-6 ps-6">
                              <input type="datetime-local" class="form-control" id="datetime" name="datetime">
                            </div>
                        </div>
                        </div>

                    
                        <!--Submit button-->
                        <div class="text-center mx-auto mb-3 mt-3">
                            <button type="submit" class="btn btn-dark text-white" value="submit">Continue</button>
                        </div>
                    </form>
                </div>
        <!-- QR code modal -->
      <div class="modal fade" id="qrCodeModal" tabindex="-1" aria-labelledby="qrCodeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="qrCodeModalLabel">QR Code</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
              <img src="<%= qrCodeUrl || '' %>" alt="QR Code" id="qrCodeImage">
            </div>
            <div class="modal-footer">
              <a href="<%= qrCodeUrl || '' %>" download="reservation_qr_code.png" class="btn btn-primary">Download QR Code</a>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
    
<%- include('footer') -%>

<script>
    // Wait for the DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', () => {
      const submitBtn = document.getElementById('submitBtn');
      const qrCodeImage = document.getElementById('qrCodeImage');

      // Attach click event listener to the submit button
      submitBtn.addEventListener('click', async () => {
        // Perform form submission using AJAX or fetch API
        const formData = new FormData(document.querySelector('form'));
        const response = await fetch('/reservation', {
          method: 'POST',
          body: formData
        });

        if (response.ok) {
          const responseData = await response.json();

          // Update the QR code image source
          qrCodeImage.src = responseData.qrCodeUrl;

          // Open the QR code modal
          const qrCodeModal = new bootstrap.Modal(document.getElementById('qrCodeModal'));
          qrCodeModal.show();
        } else {
          console.error('Reservation submission failed');
        }
      });
    });
  </script>

<script>
    function calculatePrice() {
      // Get the selected product, quantity, service, size, and delivery type
      var productSelect = document.getElementById("products");
      var qtySelect = document.getElementById("qty");
      var serviceSelect = document.getElementById("haha");
      var sizeSelect = document.getElementById("size");
      var deliverySelect = document.getElementById("delivery");
  
      var selectedProduct = productSelect.value;
      var selectedQty = parseInt(qtySelect.value);
      var selectedService = serviceSelect.value;
      var selectedSize = sizeSelect.value;
      var selectedDelivery = deliverySelect.value;
  
      // Define the prices for each product
      var productPrices = {
        "None (Dry and Fold)": 0,
        "Airiel Sunrise Fresh Liquid Detergent": 10,
        "Airiel Hygiene Pro Liquid Detergent": 15,
        "Airiel Passion Liquid Detergent": 12,
        "Breeze Power Machine Liquid Detergent (BLUE)": 8,
        "Breeze Power Machine Liquid Detergent (PINK)": 8,
      };
  
      // Define the prices for each service
      var servicePrices = {
        "Normal Wash": 60,
        "Power Wash": 80,
        "Dry": 50,
        "Fold": 30,
        "Wash and Fold": 120,
      };
  
      // Define the prices for each size
      var sizePrices = {
        "8kg below": 60,
        "8kg to 10kg": 80,
      };
  
      // Define the delivery fees based on the delivery type
      var deliveryFees = {
        "Self Service": 0,
        "Drop-off Service": 40,
        "Pick Up": 0,
        "Pick-up and Delivery": 80,
      };
  
      // Calculate the price based on the selected product, quantity, service, and size
      var productPrice = productPrices[selectedProduct] || 0;
      var servicePrice = servicePrices[selectedService] || 0;
      var sizePrice = sizePrices[selectedSize] || 0;
      var deliveryFee = deliveryFees[selectedDelivery] || 0;
  
      var totalPrice = productPrice * selectedQty;
      var subtotal = servicePrice + sizePrice + totalPrice + deliveryFee;
      var totalWithDelivery = deliveryFee;
  
      // Update the price input fields
      var priceInput = document.getElementById("price");
      priceInput.value = totalPrice.toFixed(2); // Set the price with 2 decimal places
  
      var subtotalInput = document.getElementById("subtotal");
      subtotalInput.value = subtotal.toFixed(2);
  
      var deliveryFeeInput = document.getElementById("deliveryfee");
      deliveryFeeInput.value = totalWithDelivery.toFixed(2);

      // Update the hidden fields with the calculated values
        var hiddenPriceInput = document.getElementById("hiddenPrice");
        hiddenPriceInput.value = totalPrice.toFixed(2);

        var hiddenSubtotalInput = document.getElementById("hiddenSubtotal");
        hiddenSubtotalInput.value = subtotal.toFixed(2);

        var hiddenDeliveryFeeInput = document.getElementById("hiddenDeliveryFee");
        hiddenDeliveryFeeInput.value = deliveryFee.toFixed(2);
    }
  </script>
  
  
  
  
